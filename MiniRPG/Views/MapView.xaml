<UserControl x:Class="MiniRPG.MapView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:MiniRPG.Converters"
             mc:Ignorable="d"
             d:DesignHeight="300" d:DesignWidth="400">
    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>
    <!-- TODO: Replace text with pixel-art status window -->
    <!-- TODO: Add animated portrait or player sprite here -->
    <!-- TODO: Insert background map image here -->
    <!-- TODO: Add equipment and stat bonuses -->
    <!-- TODO: Add item shop -->
    <!-- TODO: Add crafting and material combination -->
    <!-- TODO: Add quest board building on map -->
    <!-- TODO: Replace with clickable map object -->
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" /> <!-- Save message row -->
            <RowDefinition Height="Auto" /> <!-- Top bar: gold, buttons -->
            <RowDefinition Height="Auto" /> <!-- Inventory row -->
            <RowDefinition Height="Auto" /> <!-- Equipment display row -->
            <RowDefinition Height="Auto" /> <!-- Active Quests row -->
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Game Saved message -->
        <TextBlock Grid.Row="0" Text="Game Saved!" Foreground="LimeGreen" FontWeight="Bold" FontSize="16" Margin="0,0,0,8" HorizontalAlignment="Center"
                   Visibility="{Binding IsSaveConfirmed, Converter={StaticResource BoolToVis}}" Panel.ZIndex="100" />

        <!-- Gold Display in Top-Right Corner -->
        <TextBlock Grid.Row="1" 
                   Text="{Binding Player.Gold, StringFormat='Gold: {0}'}" 
                   HorizontalAlignment="Right" 
                   VerticalAlignment="Top" 
                   Margin="0,10,10,0" 
                   FontWeight="Bold" 
                   FontSize="14" 
                   Foreground="#F9E97A"
                   Panel.ZIndex="10">
            <!-- TODO: Replace text with animated coin icon -->
            <!-- TODO: Add gold transaction animations -->
        </TextBlock>

        <!-- Player Info Panel -->
        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,0,0,10">
            <TextBlock Text="Level: " FontWeight="Bold" Foreground="White" />
            <TextBlock Text="{Binding Player.Level}" Foreground="White" Margin="4,0,12,0" />
            <TextBlock Text="HP: " FontWeight="Bold" Foreground="White" />
            <TextBlock Text="{Binding Player.HP}" Foreground="White" />
            <TextBlock Text="/" Foreground="White" />
            <TextBlock Text="{Binding Player.MaxHP}" Foreground="White" Margin="4,0,12,0" />
            <TextBlock Text="EXP: " FontWeight="Bold" Foreground="White" />
            <TextBlock Text="{Binding Player.Experience}" Foreground="White" />
            <TextBlock Text="/" Foreground="White" />
            <TextBlock Text="{Binding Player.ExperienceToNextLevel}" Foreground="White" />
            <Button Content="Rest" Command="{Binding RestCommand}" Margin="16,0,0,0" Foreground="#F9E97A" Background="#222233" FontWeight="Bold">
                <!-- TODO: Replace with inn scene and cost-based healing later -->
            </Button>
            <Button Content="Save Game" Command="{Binding SaveCommand}" Margin="8,0,0,0" Foreground="#F9E97A" Background="#222233" FontWeight="Bold">
                <!-- TODO: Replace with auto-save indicator and custom UI slot menu -->
            </Button>
            <Button Content="Shop" Command="{Binding OpenShopCommand}" Margin="8,0,0,0" Foreground="#F9E97A" Background="#222233" FontWeight="Bold">
                <!-- TODO: Add multiple shop types (Weapons, Items, Blacksmith) -->
                <!-- TODO: Replace with map-based clickable shop marker -->
            </Button>
            <Button Content="Quest Board" Command="{Binding OpenQuestBoardCommand}" Margin="8,0,0,0" Foreground="#F9E97A" Background="#222233" FontWeight="Bold">
                <!-- TODO: Replace with map-based clickable quest board marker -->
            </Button>
        </StackPanel>

        <!-- Inventory Expander -->
        <Expander Grid.Row="2" Margin="0,0,0,10" Foreground="White" Background="#292944">
            <Expander.Header>
                <TextBlock>
                    <Run Text="Inventory (" />
                    <Run Text="{Binding Player.InventoryCount, Mode=OneWay}" />
                    <Run Text="/" />
                    <Run Text="{Binding Player.MaxInventoryCapacity, Mode=OneWay}" />
                    <Run Text=")" />
                </TextBlock>
            </Expander.Header>
            <!-- TODO: Replace with pixel-art inventory icons -->
            <!-- TODO: Add categories (Consumables, Materials, etc.) -->
            <!-- TODO: Add enchantments and rarity colors -->
            <StackPanel>
                <ListBox x:Name="InventoryListBox" ItemsSource="{Binding Player.Inventory}" SelectedItem="{Binding SelectedInventoryItem, Mode=TwoWay}" Background="#222233" Foreground="White" Height="100">
                    <ListBox.ItemTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <TextBlock Text="{Binding Name}" FontWeight="Bold" Foreground="White" />
                                <TextBlock Text=" (" Foreground="White" />
                                <TextBlock Text="{Binding Type}" Foreground="White" />
                                <TextBlock Text=")" Foreground="White" />
                            </StackPanel>
                        </DataTemplate>
                    </ListBox.ItemTemplate>
                </ListBox>
                <TextBlock Text="{Binding SelectedInventoryItem.Description}" Foreground="White" Margin="0,8,0,0" TextWrapping="Wrap" />
                <Button Content="Use Item" Command="{Binding UseItemCommand}" CommandParameter="{Binding SelectedItem, ElementName=InventoryListBox}" Margin="0,8,0,0" Foreground="#F9E97A" Background="#222233" FontWeight="Bold" />
                <Button Content="Equip Item" Command="{Binding EquipItemCommand}" CommandParameter="{Binding SelectedItem, ElementName=InventoryListBox}" Margin="0,8,0,0" Foreground="#F9E97A" Background="#222233" FontWeight="Bold" />
                <!-- TODO: Replace with contextual radial menu or drag/drop inventory UI -->
                <!-- TODO: Add equipment comparison screen -->
            </StackPanel>
        </Expander>

        <!-- Equipment Display -->
        <Border Grid.Row="3" Margin="0,0,0,10" Background="#292944" Padding="8">
            <StackPanel>
                <TextBlock Text="Equipment:" Foreground="#F9E97A" FontWeight="Bold" FontSize="14" Margin="0,0,0,5" />
                <TextBlock Foreground="White">
                    <Run Text="Weapon: " />
                    <Run Text="{Binding Player.EquippedWeapon.Name}" />
                </TextBlock>
                <TextBlock Foreground="White">
                    <Run Text="Armor: " />
                    <Run Text="{Binding Player.EquippedArmor.Name}" />
                </TextBlock>
                
                <!-- Player Stats Display -->
                <TextBlock Text="Stats:" Foreground="#F9E97A" FontWeight="Bold" FontSize="14" Margin="0,8,0,5" />
                <TextBlock Foreground="White">
                    <Run Text="Attack: " />
                    <Run Text="{Binding Player.Attack}" />
                </TextBlock>
                <TextBlock Foreground="White">
                    <Run Text="Defense: " />
                    <Run Text="{Binding Player.Defense}" />
                </TextBlock>
                <TextBlock Text="(Includes equipment bonuses)" Foreground="#CCCCCC" FontSize="10" FontStyle="Italic" Margin="0,2,0,0" />
                
                <!-- TODO: Replace with equipment UI grid and sprites -->
                <!-- TODO: Add unequip and compare stats feature -->
                <!-- TODO: Add accessory slot effects -->
            </StackPanel>
        </Border>

        <!-- Active Quests Expander -->
        <Expander Grid.Row="4" Header="Active Quests" Margin="0,0,0,10" Foreground="White" Background="#292944">
            <!-- TODO: Replace with quest journal UI -->
            <!-- TODO: Add completion notifications -->
            <ListBox ItemsSource="{Binding Player.ActiveQuests}" Background="#222233" Foreground="White" Height="100">
                <ListBox.ItemTemplate>
                    <DataTemplate>
                        <StackPanel>
                            <TextBlock Text="{Binding Title}" FontWeight="Bold" Foreground="White" />
                            <TextBlock Foreground="#CCCCCC">
                                <Run Text="{Binding CurrentKills}" />
                                <Run Text="/" />
                                <Run Text="{Binding RequiredKills}" />
                                <Run Text=" defeated" />
                            </TextBlock>
                        </StackPanel>
                    </DataTemplate>
                </ListBox.ItemTemplate>
            </ListBox>
        </Expander>

        <Label Grid.Row="5" Content="Choose a Battle Location" FontWeight="Bold" FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,10" Foreground="#F9E97A" />

        <ListBox Grid.Row="5" Name="LocationList" ItemsSource="{Binding Locations}" SelectedItem="{Binding SelectedLocation, Mode=TwoWay}" Margin="0,0,0,10" />

        <StackPanel Grid.Row="6" Orientation="Horizontal" HorizontalAlignment="Right">
            <Button Content="Fight!" Command="{Binding StartBattleCommand}" Width="100" Foreground="#F9E97A" Background="#222233" FontWeight="Bold" />
        </StackPanel>
    </Grid>
</UserControl>
