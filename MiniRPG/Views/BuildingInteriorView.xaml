<UserControl x:Class="MiniRPG.BuildingInteriorView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:converters="clr-namespace:MiniRPG.Converters"
             mc:Ignorable="d"
             d:DesignHeight="450" d:DesignWidth="600">
    <UserControl.Resources>
        <converters:BooleanToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>
    <!-- TODO: Add interior background art -->
    <!-- TODO: Add custom music per building type -->
    <!-- TODO: Add clickable NPC sprites -->
    <!-- TODO: Add inn stay mechanic (rest for gold) -->
    <!-- TODO: Add visual interiors with pixel furniture -->
    <!-- TODO: Add multi-room buildings and upstairs/downstairs -->
    <Grid Margin="10" Background="#222233">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
            <RowDefinition Height="Auto" />
        </Grid.RowDefinitions>

        <!-- Building Name Header -->
        <Border Grid.Row="0" 
                Background="#292944" 
                BorderBrush="#444466" 
                BorderThickness="3" 
                CornerRadius="8"
                Padding="15,10"
                Margin="0,0,0,15">
            <TextBlock Text="{Binding BuildingName}" 
                       FontSize="28" 
                       FontWeight="Bold" 
                       Foreground="#F9E97A" 
                       HorizontalAlignment="Center" />
        </Border>

        <!-- Building Description -->
        <Border Grid.Row="1" 
                Background="#292944" 
                BorderBrush="#444466" 
                BorderThickness="2" 
                CornerRadius="6"
                Padding="12"
                Margin="0,0,0,15">
            <TextBlock Text="{Binding BuildingDescription}" 
                       FontSize="14" 
                       Foreground="White" 
                       TextWrapping="Wrap"
                       HorizontalAlignment="Center" />
        </Border>

        <!-- Occupants Expander -->
        <Expander Grid.Row="2" 
                  Header="Occupants" 
                  Margin="0,0,0,15" 
                  Foreground="White" 
                  Background="#292944"
                  IsExpanded="True">
            <Border Background="#222233" 
                    BorderBrush="#444466" 
                    BorderThickness="2" 
                    Padding="10">
                <StackPanel>
                    <ListBox x:Name="OccupantListBox" 
                             ItemsSource="{Binding Occupants}" 
                             SelectedItem="{Binding SelectedNPC, Mode=TwoWay}" 
                             Background="#1A1A2E" 
                             Foreground="White" 
                             MinHeight="120"
                             MaxHeight="200"
                             BorderThickness="0">
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal" Margin="0,4">
                                    <TextBlock Text="{Binding Name}" 
                                               FontWeight="Bold" 
                                               Foreground="#F9E97A" 
                                               Margin="0,0,8,0" />
                                    <TextBlock Text="(" Foreground="#AABBCC" />
                                    <TextBlock Text="{Binding Role}" 
                                               Foreground="#AABBCC" />
                                    <TextBlock Text=")" Foreground="#AABBCC" />
                                </StackPanel>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                    
                    <!-- Talk Button -->
                    <Button Content="Talk" 
                            Command="{Binding TalkToNPCCommand}" 
                            CommandParameter="{Binding SelectedItem, ElementName=OccupantListBox}" 
                            Margin="0,10,0,0" 
                            Padding="12,8"
                            Foreground="#F9E97A" 
                            Background="#444466" 
                            FontWeight="Bold"
                            FontSize="14"
                            HorizontalAlignment="Center"
                            MinWidth="120">
                        <Button.Style>
                            <Style TargetType="Button">
                                <Setter Property="Background" Value="#444466" />
                                <Style.Triggers>
                                    <Trigger Property="IsMouseOver" Value="True">
                                        <Setter Property="Background" Value="#555577" />
                                    </Trigger>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Background" Value="#333344" />
                                        <Setter Property="Foreground" Value="#888899" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Button.Style>
                    </Button>

                    <!-- Inn Stay Section (only visible for inns) -->
                    <StackPanel Visibility="{Binding IsInn, Converter={StaticResource BoolToVis}}" 
                                Margin="0,15,0,0">
                        <!-- TODO: Replace with innkeeper NPC dialogue and fade-out sleep animation -->
                        <!-- TODO: Add sound effect for morning wake-up -->
                        <!-- TODO: Replace with animated fade-to-black -->
                        <!-- TODO: Add morning light transition -->
                        
                        <!-- Stay the Night Button -->
                        <Button Content="Stay the Night" 
                                Command="{Binding StayAtInnCommand}" 
                                Padding="12,8"
                                Foreground="#F9E97A" 
                                Background="#446644" 
                                FontWeight="Bold"
                                FontSize="14"
                                HorizontalAlignment="Center"
                                MinWidth="180">
                            <Button.Style>
                                <Style TargetType="Button">
                                    <Setter Property="Background" Value="#446644" />
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#557755" />
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Button.Style>
                        </Button>
                        
                        <!-- Cost Note -->
                        <TextBlock Text="Cost: 20 Gold" 
                                   FontSize="12" 
                                   FontStyle="Italic" 
                                   Foreground="#CCCCCC" 
                                   HorizontalAlignment="Center" 
                                   Margin="0,6,0,0" />
                    </StackPanel>
                </StackPanel>
            </Border>
        </Expander>

        <!-- Leave Building Button -->
        <Button Grid.Row="3" 
                Content="Leave Building" 
                Command="{Binding ExitBuildingCommand}"
                Padding="16,10"
                Foreground="#F9E97A" 
                Background="#664444" 
                FontWeight="Bold"
                FontSize="16"
                HorizontalAlignment="Center"
                MinWidth="180">
            <Button.Style>
                <Style TargetType="Button">
                    <Setter Property="Background" Value="#664444" />
                    <Style.Triggers>
                        <Trigger Property="IsMouseOver" Value="True">
                            <Setter Property="Background" Value="#775555" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
            </Button.Style>
        </Button>

        <!-- Sleeping Overlay (displayed during inn rest) -->
        <Border Grid.RowSpan="4" 
                Background="#000000"
                Visibility="{Binding IsSleeping, Converter={StaticResource BoolToVis}}"
                Panel.ZIndex="1000">
            <TextBlock Text="Sleeping..." 
                       FontSize="48" 
                       FontWeight="Bold" 
                       Foreground="White" 
                       HorizontalAlignment="Center" 
                       VerticalAlignment="Center" />
        </Border>
    </Grid>
</UserControl>
